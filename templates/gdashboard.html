<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Government Health Analytics Dashboard</title>

  <!-- App CSS (cache-busted) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css', v=3) }}">

  <!-- Third-party CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>

  <style>
    /* Sidebar Styles */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 0;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 20px;
      background: #34495e;
      border-bottom: 1px solid #3e5770;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      color: #ecf0f1;
    }

    .sidebar-subtitle {
      font-size: 12px;
      color: #bdc3c7;
      margin: 5px 0 0 0;
    }

    .sidebar-nav {
      padding: 0;
      margin: 0;
      list-style: none;
    }

    .nav-item {
      border-bottom: 1px solid #34495e;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: #ecf0f1;
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .nav-link:hover {
      background: #34495e;
      color: #3498db;
    }

    .nav-link.active {
      background: #3498db;
      color: white;
      border-right: 3px solid #2980b9;
    }

    .nav-icon {
      margin-right: 12px;
      width: 16px;
      text-align: center;
    }

    /* Main content adjustment */
    .main-content {
      flex: 1;
      margin-left: 250px;
      min-height: 100vh;
      background: #f8f9fa;
    }

    .dashboard-container {
      width: 100%;
    }

    .dashboard-header {
      background: white;
      border-bottom: 1px solid #e1e5e9;
      padding: 15px 30px;
      margin: 0;
    }

    /* Keep Leaflet layers above tiles */
    #map { height: 450px; width: 100%; border-radius: 5px; z-index: 0; }
    .leaflet-overlay-pane svg { z-index: 200; }
    .leaflet-interactive { fill-opacity: 1 !important; stroke-opacity: 1 !important; }
    .leaflet-overlay-pane { z-index: 200; }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .sidebar.mobile-open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .mobile-menu-btn {
        display: block;
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 1001;
        background: #3498db;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
      }
    }

    .mobile-menu-btn {
      display: none;
    }
  </style>

  <!-- Charts and icons -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <!-- Mobile menu button -->
  <button class="mobile-menu-btn" id="mobile-menu-btn">
    <i class="fas fa-bars"></i>
  </button>

  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2 class="sidebar-title">Health Analytics</h2>
        <p class="sidebar-subtitle">Government Portal</p>
      </div>
      
      <nav>
        <ul class="sidebar-nav">
          <li class="nav-item">
            <a href="/" class="nav-link active" data-page="dashboard">
              <i class="fas fa-chart-bar nav-icon"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="/approve-doctors" class="nav-link" data-page="approve-doctors">
              <i class="fas fa-user-md nav-icon"></i>
              Approve Doctors
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
          <div class="header-content">
            <h1 class="dashboard-title">
              <i class="fas fa-shield-alt"></i>
              Government Health Analytics
            </h1>
            <div class="user-info">
              <span class="user-role">Government Official</span>
            </div>
          </div>
        </header>

        <!-- Main Dashboard Content -->
        <div class="dashboard-main" style="padding: 30px;">
          <div class="grid-container">
            <!-- Official Profile -->
            <div class="card official-profile">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-shield-alt"></i> Official Profile</h3>
              </div>
              <div class="card-content">
                <div class="official-info">
                  <h4 class="official-name">Dr. Patricia Williams</h4>
                  <p class="official-department">Public Health Department</p>
                  <p class="official-id">ID: PHD-2024-001</p>
                </div>
                <div class="official-details">
                  <div class="detail-row">
                    <span class="detail-label">Region:</span>
                    <span>State Health Authority</span>
                  </div>
                  <div class="detail-row">
                    <span class="detail-label">Access Level:</span>
                    <span class="badge">Level 3 - Health Analytics</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Controls -->
            <div class="card controls-card">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-chart-bar"></i> Analytics Controls</h3>
                <p class="card-description">Filter and export health data</p>
              </div>
              <div class="card-content">
                <div class="controls-grid">
                  <div class="control-group">
                    <label class="control-label">Region</label>
                    <select id="regionSelect" class="select-input"></select>
                  </div>
                  <div class="control-group">
                    <label class="control-label">Year</label>
                    <select id="yearSelect" class="select-input"></select>
                  </div>
                  <div class="control-group">
                    <label class="control-label">Week Number</label>
                    <select id="weekSelect" class="select-input"></select>
                  </div>
                  <div class="control-group">
                    <label class="control-label">Number of Weeks</label>
                    <select id="numWeeksSelect" class="select-input">
                      <option value="1">1 Week</option>
                      <option value="4">4 Weeks</option>
                      <option value="12">12 Weeks</option>
                    </select>
                  </div>
                </div>
                <div class="export-buttons">
                  <button class="btn btn-outline" onclick="exportData('pdf')"><i class="fas fa-download"></i> Export PDF</button>
                  <button class="btn btn-outline" onclick="exportData('csv')"><i class="fas fa-download"></i> Export CSV</button>
                  <button class="btn btn-outline" onclick="exportData('xlsx')"><i class="fas fa-download"></i> Export Excel</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Indicators -->
          <div class="indicators-grid">
            <div class="indicator-card">
              <div class="indicator-content">
                <div class="indicator-info">
                  <p class="indicator-label">No. of cases reported</p>
                  <p class="indicator-value" data-id="total-cases">0</p>
                </div>
                <i class="fas fa-users indicator-icon text-blue"></i>
              </div>
            </div>
            <div class="indicator-card">
              <div class="indicator-content">
                <div class="indicator-info">
                  <p class="indicator-label">City with most cases</p>
                  <p class="indicator-value" data-id="top-city">–</p>
                </div>
                <i class="fas fa-city indicator-icon text-red"></i>
              </div>
            </div>
            <div class="indicator-card">
              <div class="indicator-content">
                <div class="indicator-info">
                  <p class="indicator-label">Total Deaths</p>
                  <p class="indicator-value" data-id="total-deaths">0</p>
                </div>
                <i class="fas fa-exclamation-triangle indicator-icon text-red"></i>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="card chart-card">
            <div class="card-header">
              <div class="card-header-content">
                <h3 class="card-title"><i class="fas fa-trending-up"></i> Disease Trends Over Time</h3>
                <div class="control-group">
                  <label class="control-label">Chart Year</label>
                  <select id="chartYearSelect" class="select-input"></select>
                </div>
              </div>
              <p class="card-description">Monthly disease case trends by category</p>
            </div>
            <div class="card-content">
              <div class="chart-container"><canvas id="diseaseTrendChart"></canvas></div>
            </div>
          </div>

          <div class="charts-grid">
            <div class="card">
              <div class="card-header">
                <div class="card-header-content">
                  <h3 class="card-title"><i class="fas fa-map-marker-alt"></i> Regional Health Statistics</h3>
                  <div class="control-group">
                    <label class="control-label">Chart Year</label>
                    <select id="regionalYearSelect" class="select-input"></select>
                  </div>
                </div>
                <p class="card-description">Top 5 districts by total cases</p>
              </div>
              <div class="card-content">
                <div class="chart-container"><canvas id="regionalChart"></canvas></div>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <h3 class="card-title"><i class="fas fa-map-marked-alt"></i> Interactive Map</h3>
                <p class="card-description">Case distribution by district</p>
                <div class="control-group">
                  <label class="control-label">Year</label>
                  <select id="heatYearSelect" class="select-input"></select>
                </div>
              </div>
              <div class="card-content"><div id="map"></div></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- BOT ICON -->
  <div id="chat-toggle-button" title="Assistant"
       style="position:fixed;bottom:30px;right:30px;width:60px;height:60px;background:#3498db;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:2147483647;">
    <i class="fas fa-robot"></i>
  </div>

  <!-- POPUP CHAT -->
  <div id="chat-popup" aria-hidden="true" style="display:none;position:fixed;bottom:100px;right:30px;width:350px;height:500px;background:white;border-radius:15px;box-shadow:0 15px 35px rgba(0,0,0,0.2);z-index:2147483646;overflow:hidden;border:1px solid #e1e5e9;">
    <div class="cp-header" style="background:#3498db;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;">
      <span class="cp-title" style="font-weight:600;font-size:16px;">Assistant</span>
      <button id="cp-close" aria-label="Close" style="background:none;border:none;color:white;font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;">×</button>
    </div>
    <div id="cp-body" class="cp-body" style="height:360px;overflow-y:auto;padding:15px;background:#f8f9fa;">
      <div class="cp-msg bot" style="margin-bottom:15px;display:flex;">
        <div class="cp-bubble" style="max-width:80%;padding:10px 15px;border-radius:18px;word-wrap:break-word;background:white;border:1px solid #e1e5e9;color:#2c3e50;">Hello! How can I help with the health data today?</div>
      </div>
    </div>
    <div class="cp-footer" style="padding:15px;border-top:1px solid #e1e5e9;display:flex;gap:10px;">
      <input id="cp-input" type="text" placeholder="Type a message..." autocomplete="off" style="flex:1;border:1px solid #e1e5e9;border-radius:20px;padding:10px 15px;outline:none;font-size:14px;" />
      <button id="cp-send" aria-label="Send" style="background:#3498db;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // Sidebar navigation functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Handle navigation clicks
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Remove active class from all links
          navLinks.forEach(l => l.classList.remove('active'));
          
          // Add active class to clicked link
          this.classList.add('active');
          
          // Handle page navigation
          const page = this.dataset.page;
          if (page === 'approve-doctors') {
            window.location.href = '/approve-doctors';
          } else {
            window.location.href = '/';
          }
        });
      });

      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const sidebar = document.getElementById('sidebar');
      
      if (mobileMenuBtn && sidebar) {
        mobileMenuBtn.addEventListener('click', function() {
          sidebar.classList.toggle('mobile-open');
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
          if (window.innerWidth <= 768 && 
              !sidebar.contains(e.target) && 
              !mobileMenuBtn.contains(e.target)) {
            sidebar.classList.remove('mobile-open');
          }
        });
      }
    });
  </script>
  <script src="{{ url_for('static', filename='script.js', v=3) }}"></script>
</body>
</html>